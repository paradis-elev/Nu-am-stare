<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Ultimate 2D Shooter</title>
<style>
    body { margin:0; overflow:hidden; background:#111; }
    #hud {
        position:fixed; top:10px; left:10px;
        color:white; font-family:monospace;
        font-size:20px; z-index:5;
    }
    #weapon {
        position:fixed; top:10px; right:10px;
        color:yellow; font-family:monospace;
        font-size:20px; z-index:5;
    }
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hud">
  HP: <span id="hp">100</span><br>
  Enemies Left: <span id="remain">10</span><br>
  Level: <span id="level">1</span><br>
  Ammo: <span id="ammo">∞</span>
</div>
<div id="weapon">Weapon: Pistol (1)</div>

<script>
/* ========================= CANVAS ========================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;
addEventListener("resize", ()=>{ canvas.width=innerWidth; canvas.height=innerHeight; });

/* ========================= PLAYER ========================= */
const player = {
    x: canvas.width/2,
    y: canvas.height/2,
    size: 25,
    speed: 5,
    hp: 100,
    weapon: 1,
    ammo: {1: Infinity, 2: 30, 3: 50},
    maxAmmo: {2: 30, 3: 50}
};

document.getElementById("ammo").textContent = "∞";

/* ========================= INPUT ========================= */
const keys = {};
document.addEventListener("keydown", e => {
    keys[e.key] = true;

    if (["1","2","3"].includes(e.key)) changeWeapon(+e.key);
});
document.addEventListener("keyup", e => keys[e.key] = false);

document.addEventListener("mousedown", fire);
document.addEventListener("contextmenu", e => e.preventDefault());

/* ========================= WEAPONS ========================= */
function changeWeapon(n) {
    player.weapon = n;
    const w = ["", "Pistol", "Shotgun", "SMG"][n];
    document.getElementById("weapon").textContent = `Weapon: ${w} (${n})`;

    document.getElementById("ammo").textContent =
        player.ammo[n] === Infinity ? "∞" : player.ammo[n];
}

/* ========================= BULLETS ========================= */
const bullets = [];

function fire(e) {
    if (player.weapon !== 1 && player.ammo[player.weapon] <= 0) return;

    const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);

    // pistol
    if (player.weapon === 1) {
        spawnBullet(angle, 12);
        screenShake(3);
    }

    // shotgun
    else if (player.weapon === 2) {
        for (let i = -2; i <= 2; i++) {
            spawnBullet(angle + i * 0.1, 10);
        }
        player.ammo[2]--;
        screenShake(8);
    }

    // machinegun
    else if (player.weapon === 3) {
        spawnBullet(angle, 15);
        player.ammo[3]--;
        screenShake(2);
    }

    if (player.weapon !== 1)
        document.getElementById("ammo").textContent = player.ammo[player.weapon];
}

function spawnBullet(a, speed) {
    bullets.push({
        x: player.x,
        y: player.y,
        dx: Math.cos(a) * speed,
        dy: Math.sin(a) * speed,
        size: 6
    });
}

/* ========================= ENEMIES ========================= */
let enemies = [];
let level = 1;
let enemiesLeft = 10;

function spawnEnemy() {
    let x=0, y=0;
    let side = Math.floor(Math.random()*4);

    if (side===0) {x=0; y=Math.random()*canvas.height;}
    if (side===1) {x=canvas.width; y=Math.random()*canvas.height;}
    if (side===2) {x=Math.random()*canvas.width; y=0;}
    if (side===3) {x=Math.random()*canvas.width; y=canvas.height;}

    enemies.push({
        x,y,
        size:30,
        speed:1 + level*0.2,
        hp: 20 + level*5
    });
}

function nextLevel() {
    level++;
    enemiesLeft = 10 + level * 5;
    document.getElementById("level").textContent = level;
    document.getElementById("remain").textContent = enemiesLeft;
}

/* ========================= PARTICLES ========================= */
const particles = [];

function spawnParticles(x, y, color="orange") {
    for (let i=0;i<20;i++) {
        const a = Math.random()*Math.PI*2;
        particles.push({
            x,y,
            dx: Math.cos(a)*Math.random()*5,
            dy: Math.sin(a)*Math.random()*5,
            size: 4,
            color,
            life: 20
        });
    }
}

/* ========================= SCREEN SHAKE ========================= */
let shake = 0;
function screenShake(amount) { shake = amount; }

/* ========================= GAME LOOP ========================= */
function update() {
    /* movement */
    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    /* bullets update */
    for (let i=bullets.length-1;i>=0;i--) {
        const b = bullets[i];
        b.x += b.dx;
        b.y += b.dy;

        if (b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height)
            bullets.splice(i,1);
    }

    /* enemies update */
    for (let i=enemies.length-1;i>=0;i--) {
        const e = enemies[i];
        const ang = Math.atan2(player.y-e.y, player.x-e.x);
        e.x += Math.cos(ang)*e.speed;
        e.y += Math.sin(ang)*e.speed;

        // contact cu jucătorul
        if (dist(player,e) < player.size+e.size) {
            player.hp -= 0.5;
            document.getElementById("hp").textContent = Math.floor(player.hp);
            if (player.hp <= 0) {
                alert("Ai murit! Refresh pentru restart.");
                location.reload();
            }
        }

        // lovit de glonț
        for (let j=bullets.length-1;j>=0;j--) {
            const b = bullets[j];
            if (dist(b,e) < e.size) {
                e.hp -= 20;
                bullets.splice(j,1);

                if (e.hp <= 0) {
                    spawnParticles(e.x,e.y);
                    enemies.splice(i,1);
                    enemiesLeft--;
                    document.getElementById("remain").textContent = enemiesLeft;

                    if (enemiesLeft === 0) nextLevel();
                }
                break;
            }
        }
    }

    /* spawn enemies */
    if (enemies.length < 5 + level * 2 && enemiesLeft > 0) spawnEnemy();

    /* particles */
    for (let i=particles.length-1;i>=0;i--) {
        const p = particles[i];
        p.x+=p.dx; p.y+=p.dy;
        p.life--;
        if (p.life<=0) particles.splice(i,1);
    }

    /* screen shake */
    if (shake>0) shake -= 0.5;
}

function dist(a,b) { return Math.hypot(a.x-b.x,a.y-b.y); }

/* ========================= DRAW ========================= */
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.save();
    ctx.translate((Math.random()-0.5)*shake,(Math.random()-0.5)*shake);

    // player
    ctx.fillStyle="lime";
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
    ctx.fill();

    // bullets
    ctx.fillStyle="yellow";
    for (let b of bullets) {
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.size,0,Math.PI*2);
        ctx.fill();
    }

    // enemies
    ctx.fillStyle="red";
    for (let e of enemies) {
        ctx.beginPath();
        ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
        ctx.fill();
    }

    // particles
    for (let p of particles) {
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,p.size,p.size);
    }

    ctx.restore();
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
