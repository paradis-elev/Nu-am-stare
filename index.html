<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Joc 3D FPS Complet</title>
<style>
    body { margin: 0; overflow: hidden; background: #000; }
    #hud {
        position: fixed;
        top: 10px; left: 10px;
        color: #0f0;
        font-family: monospace;
        font-size: 22px;
        z-index: 10;
    }
    #crosshair {
        position: fixed;
        top: 50%; left: 50%;
        width: 10px; height: 10px;
        margin-left: -5px; margin-top: -5px;
        background: white;
        border-radius: 50%;
        z-index: 5;
    }
</style>
</head>
<body>

<div id="hud">HP: <span id="hp">100</span></div>
<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<script>
/* ===================== SETUP SCENĂ ===================== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x202020);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 1.6, 5);

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ===================== LUMINI ===================== */
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,2);
scene.add(light);

/* ===================== TEREN ===================== */
const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(200, 200),
    new THREE.MeshStandardMaterial({color: 0x333333})
);
plane.rotation.x = -Math.PI/2;
scene.add(plane);

/* ===================== ARMĂ ===================== */
const gun = new THREE.Mesh(
    new THREE.BoxGeometry(0.4, 0.2, 1),
    new THREE.MeshStandardMaterial({color: 0x2244ff})
);
gun.position.set(0.3, -0.2, -1.2);
camera.add(gun);
scene.add(camera);

/* Flash la împușcătură */
const flash = new THREE.PointLight(0xffffaa, 0, 5);
flash.position.set(0.3, -0.1, -0.8);
camera.add(flash);

/* ===================== CONTROALE ===================== */
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

document.body.addEventListener("click", () => {
    document.body.requestPointerLock();
});

/* Mișcare cameră + mouse look */
let yaw = 0, pitch = 0;
document.addEventListener("mousemove", e => {
    if (document.pointerLockElement !== document.body) return;
    yaw -= e.movementX * 0.002;
    pitch -= e.movementY * 0.002;
    pitch = Math.max(-1.2, Math.min(1.2, pitch));
    camera.rotation.set(pitch, yaw, 0);
});

/* ===================== PROIECTILE ===================== */
let bullets = [];

function shoot() {
    // glonț
    const geo = new THREE.SphereGeometry(0.05, 8, 8);
    const mat = new THREE.MeshStandardMaterial({color: 0xffff00});
    const bullet = new THREE.Mesh(geo, mat);

    bullet.position.copy(camera.position);
    const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
    bullet.velocity = dir.multiplyScalar(0.6);

    bullets.push(bullet);
    scene.add(bullet);

    // recul armă
    gun.position.z -= 0.1;
    setTimeout(() => gun.position.z += 0.1, 50);

    // flash
    flash.intensity = 3;
    setTimeout(() => flash.intensity = 0, 50);
}

document.addEventListener("mousedown", shoot);

/* ===================== INAMICI ===================== */
let enemies = [];

function spawnEnemy() {
    const geo = new THREE.BoxGeometry(1, 2, 1);
    const mat = new THREE.MeshStandardMaterial({color: 0xff3333});
    const e = new THREE.Mesh(geo, mat);

    const dist = 30;
    const angle = Math.random() * Math.PI * 2;
    e.position.set(Math.cos(angle)*dist, 1, Math.sin(angle)*dist);

    enemies.push(e);
    scene.add(e);
}

setInterval(spawnEnemy, 2500);

/* ===================== HP ===================== */
let hp = 100;
function damagePlayer(amount) {
    hp -= amount;
    document.getElementById("hp").textContent = hp;
    if (hp <= 0) alert("Ai murit!");
}

/* ===================== LOOP ===================== */
function animate() {
    requestAnimationFrame(animate);

    /* Mișcare jucător */
    const speed = 0.15;
    let dir = new THREE.Vector3();
    if (keys["w"]) dir.z -= speed;
    if (keys["s"]) dir.z += speed;
    if (keys["a"]) dir.x -= speed;
    if (keys["d"]) dir.x += speed;

    dir.applyQuaternion(camera.quaternion);
    camera.position.add(dir);

    /* Actualizare gloanțe */
    for (let i = bullets.length-1; i >= 0; i--) {
        const b = bullets[i];
        b.position.add(b.velocity);

        // eliminare
        if (b.position.length() > 200) {
            scene.remove(b);
            bullets.splice(i,1);
            continue;
        }

        // coliziuni cu inamici
        for (let j = enemies.length-1; j >= 0; j--) {
            const e = enemies[j];
            if (b.position.distanceTo(e.position) < 1) {
                // lovit
                scene.remove(e);
                enemies.splice(j,1);
                scene.remove(b);
                bullets.splice(i,1);
                break;
            }
        }
    }

    /* Inamici se apropie */
    for (let e of enemies) {
        const dir = camera.position.clone().sub(e.position).normalize();
        e.position.add(dir.multiplyScalar(0.03));

        // atacă jucătorul
        if (e.position.distanceTo(camera.position) < 1.5) {
            damagePlayer(1);
        }
    }

    renderer.render(scene, camera);
}

animate();

/* ===================== REDIMENSIONARE ===================== */
window.addEventListener("resize", () => {
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
